<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Exercícios 4.6 — Deadlock</title>
    <style>
        :root {
            --bg: #f6f8fb;
            --surface: #fff;
            --border: #dde2eb;
            --text: #1f2937;
            --muted: #6b7280;
            --hover: #e6ecf5;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, sans-serif;
            color: var(--text);
            background: var(--bg);
        }

        main {
            padding: 14px;
        }

        h3 {
            margin: 0 0 10px;
        }

        .exercise {
            border: 1px dashed var(--border);
            border-radius: 10px;
            padding: 12px;
            margin: 12px 0;
        }

        .options {
            display: grid;
            gap: 8px;
        }

        .option-btn {
            appearance: none;
            border: 1px solid var(--border);
            background: var(--surface);
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            text-align: left;
            transition: background-color .15s, border-color .15s, box-shadow .15s;
        }

        .option-btn:hover {
            background: var(--hover);
        }

        .option-btn:focus {
            outline: 2px solid transparent;
            box-shadow: 0 0 0 3px rgba(94, 129, 172, .35);
        }

        .option-btn.correct {
            border-color: #2a9d8f;
            background: rgba(42, 157, 143, .10);
        }

        .option-btn.incorrect {
            border-color: #e76f51;
            background: rgba(231, 111, 81, .10);
        }

        .exercise-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .redo-btn {
            appearance: none;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            border-radius: 10px;
            padding: 8px 12px;
            cursor: pointer;
        }

        .redo-btn:hover {
            background: var(--hover);
        }

        .feedback {
            margin-top: 6px;
            color: var(--muted);
        }

        .why {
            margin-top: 6px;
        }

        .why summary {
            cursor: pointer;
            color: var(--muted);
        }

        .explanation {
            margin-top: 6px;
        }
    </style>
</head>

<body>
    <main>
        <h3>Exercícios 4.6 — Deadlock</h3>
        <div id="ex-list"></div>
    </main>
    <script>
        const QUESTIONS = [
            {
                prompt: "O que é deadlock (impasse)?",
                options: ["Quando uma thread executa muito rápido", "Quando threads esperam uma pela outra indefinidamente, bloqueando a execução", "Quando uma thread termina com erro"],
                answerIndex: 1,
                explanation: "Deadlock ocorre quando duas ou mais threads ficam bloqueadas esperando recursos que uma segura e a outra precisa, e vice-versa."
            },
            {
                prompt: "No cenário clássico de deadlock, Thread A possui Lock1 e quer Lock2, enquanto Thread B...",
                options: ["Também quer Lock1", "Possui Lock2 e quer Lock1", "Não usa nenhum lock"],
                answerIndex: 1,
                explanation: "Este é o cenário clássico: A tem Lock1 e quer Lock2, B tem Lock2 e quer Lock1. Ambas ficam bloqueadas indefinidamente."
            },
            {
                prompt: "Como evitar deadlocks?",
                options: ["Usar mais threads", "Adquirir locks sempre na mesma ordem e evitar segurar múltiplos locks por muito tempo", "Nunca usar synchronized"],
                answerIndex: 1,
                explanation: "Manter uma ordem consistente ao adquirir recursos e minimizar o tempo segurando múltiplos locks ajuda a evitar deadlocks."
            }
        ];

        function shuffle(arr) { return arr.map(v => ({ v, r: Math.random() })).sort((a, b) => a.r - b.r).map(o => o.v); }

        function render() {
            const list = document.getElementById('ex-list');
            list.innerHTML = '';
            QUESTIONS.forEach((q) => {
                const ex = document.createElement('div');
                ex.className = 'exercise';
                ex.innerHTML = `
          <h4>${q.prompt}</h4>
          <div class="options"></div>
          <div class="exercise-actions"><button class="redo-btn" type="button">Refazer</button></div>
          <div class="feedback" aria-live="polite"></div>
        `;
                const optsEl = ex.querySelector('.options');
                const fb = ex.querySelector('.feedback');
                const order = shuffle(Array.from({ length: q.options.length }, (_, i) => i));
                optsEl.innerHTML = order.map(i => `<button class="option-btn" data-i="${i}">${q.options[i]}</button>`).join('');
                optsEl.querySelectorAll('.option-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const chosen = Number(btn.getAttribute('data-i'));
                        const correct = chosen === q.answerIndex;
                        ex.querySelectorAll('.option-btn').forEach(b => b.classList.remove('correct', 'incorrect'));
                        btn.classList.add(correct ? 'correct' : 'incorrect');
                        fb.innerHTML = correct ? `Correto! ✅${q.explanation ? `<div class=\"explanation\">${q.explanation}</div>` : ''}` : `Incorreto. <details class=\"why\"><summary>Por quê?</summary><div class=\"explanation\">${q.explanation || 'Releia os conceitos desta subseção.'}</div></details>`;
                    });
                });
                ex.querySelector('.redo-btn').addEventListener('click', () => {
                    const order2 = shuffle(Array.from({ length: q.options.length }, (_, i) => i));
                    optsEl.innerHTML = order2.map(i => `<button class="option-btn" data-i="${i}">${q.options[i]}</button>`).join('');
                    fb.textContent = '';
                    optsEl.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const chosen = Number(btn.getAttribute('data-i'));
                            const correct = chosen === q.answerIndex;
                            ex.querySelectorAll('.option-btn').forEach(b => b.classList.remove('correct', 'incorrect'));
                            btn.classList.add(correct ? 'correct' : 'incorrect');
                            fb.innerHTML = correct ? `Correto! ✅${q.explanation ? `<div class=\"explanation\">${q.explanation}</div>` : ''}` : `Incorreto. <details class=\"why\"><summary>Por quê?</summary><div class=\"explanation\">${q.explanation || 'Releia os conceitos desta subseção.'}</div></details>`;
                        });
                    });
                });
                list.appendChild(ex);
            });
        }

        render();
    </script>
</body>

</html>